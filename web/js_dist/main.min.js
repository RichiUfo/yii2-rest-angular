/*
 yii-rest 2015-03-06 
*/
function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}function plural_str(a,b,c,d){return a=Math.abs(a),a%=100,a>=5&&20>=a?d:(a%=10,1==a?b:a>=2&&4>=a?c:d)}!function(){"use strict";angular.module("app",["ui.router","angular.filter"])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(){f.create(p.article).then(function(){a.go("body.main")})["catch"](function(a){angular.forEach(a.data,function(a){p.errors[a.field]=a.message})})}function l(a,b){a.type=f.model,a.type_id=p.arrParams.id,a.parent_id=b||0,g.create(a).then(function(a){p.comments.push(a.data),p.comments=c("orderBy")(p.comments,"hash"),p.comment={},p.errors=[],m("comment_"+a.data.id)})["catch"](function(a){angular.forEach(a.data,function(a){p.errors[a.field]=a.message})})}function m(a){return a?(d.hash(a),void e()):!1}function n(a,b){g.rate(a.id,b).then(function(){b?++a.rate:--a.rate})}function o(a){var b=a.hash.slice(0,2),c=p.toggleTrees.indexOf(b);c>-1?p.toggleTrees.splice(c,1):p.toggleTrees.push(b),angular.forEach(p.comments,function(a,b){p.comments[b].showComment=!(p.toggleTrees.indexOf(a.hash.slice(0,2))>-1&&a.level>1)})}var p=this;p.articles=h.data,p.article=i.data,p.arrParams=a.params,p.comments=j.data,p.comment={},p.errors=[],p.toggleTrees=[],p.createArticle=k,p.addComment=l,p.gotoComment=m,p.changeRate=n,p.toggleTree=o,b.rndBG=getRandomInt(1,4),p.article?(b.title=p.article.title,b.createdArticle=p.article.created):(b.title="",b.createdArticle="")}angular.module("app").controller("articleController",a),a.$inject=["$state","$rootScope","$filter","$location","$anchorScroll","articleService","commentService","articles","article","comments"]}(),function(){"use strict";function a(a){a.defaultTitle="Блог",a.rndBG=getRandomInt(1,4)}angular.module("app").controller("headerController",a),a.$inject=["$rootScope"]}(),function(){"use strict";function a(){return function(a,b,c){if(!a)return"никогда";if(b||(b=Date.now()),angular.isDate(a)?a=a.getTime():"string"==typeof a&&(a=new Date(a).getTime()),angular.isDate(b)?b=b.getTime():"string"==typeof b&&(b=new Date(b).getTime()),"number"==typeof a&&"number"==typeof b){var d=Math.abs((b-a)/1e3),e=[],f=60,g=3600,h=86400,i=604800,j=31556926;return e=f>=d?["",c?"":"только что"]:60*f>d?[Math.round(Math.abs(d/f)),plural_str(Math.round(Math.abs(d/f)),"минута","минуты","минут")]:24*g>d?[Math.round(Math.abs(d/g)),plural_str(Math.round(Math.abs(d/g)),"час","часа","часов")]:7*h>d?[Math.round(Math.abs(d/h)),plural_str(Math.round(Math.abs(d/h)),"день","дня","дней")]:52*i>d?[Math.round(Math.abs(d/i)),plural_str(Math.round(Math.abs(d/i)),"неделя","недели","недель")]:10*j>d?[Math.round(Math.abs(d/j)),plural_str(Math.round(Math.abs(d/j)),"год","года","лет")]:["","давным давно в далекой далекой галактике"],e=e.join(" "),c===!0?e:b>=a?e+" назад":""+e}}}angular.module("app").filter("timeago",a)}(),function(){"use strict";angular.module("app").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("body",{templateUrl:"views/body.html",controller:["$scope","$rootScope","$state",function(a,b,c){b.state=c}]}).state("body.main",{url:"/",views:{main:{templateUrl:"views/article/main.html",controller:"articleController",controllerAs:"articleCtrl",resolve:{articles:["articleService",function(a){return a.all()}],article:function(){return{}},comments:function(){return{}}}}}}).state("body.article",{url:"/article/:id",views:{main:{templateUrl:"views/article/view.html",controller:"articleController",controllerAs:"articleCtrl",resolve:{articles:function(){return{}},article:["$stateParams","articleService",function(a,b){return b.get(a.id)}],comments:["$stateParams","commentService","articleService",function(a,b,c){return b.all(c.model,a.id)}]}}}}).state("body.articleCreate",{url:"/articles/create",views:{main:{templateUrl:"views/article/create.html",controller:"articleController",controllerAs:"articleCtrl",resolve:{articles:function(){return{}},article:function(){return{}}}}}})}])}(),function(){"use strict";angular.module("app").factory("articleService",["$http",function(a){return{model:"article",all:function(){return a.get("api/articles")},create:function(b){return a.post("api/articles",b)},get:function(b){return a.get("api/articles/"+b)},update:function(b){return a.put("api/articles/"+b)},deleteItem:function(b){return a["delete"]("api/articles/"+b)}}}])}(),function(){"use strict";angular.module("app").factory("commentService",["$http",function(a){return{all:function(b,c){return a.get("api/comments/"+b+"/"+c)},create:function(b){return a.post("api/comments",b)},get:function(b){return a.get("api/comments/"+b)},update:function(b){return a.put("api/comments/"+b)},deleteItem:function(b){return a["delete"]("api/comments/"+b)},rate:function(b,c){return a.post("api/comments/"+b+"/rate/"+c)}}}])}();